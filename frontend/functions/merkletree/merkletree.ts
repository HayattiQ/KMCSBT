import { Handler } from '@netlify/functions'
import keccak256 from 'keccak256'
import { MerkleTree } from 'merkletreejs'
import { ethers } from 'ethers'

export const handler: Handler = async (event, context) => {
  const address = event.queryStringParameters?.address?.toLowerCase()
  if (!address) {
    return { statusCode: 400, body: 'Set address on API' }
  }

  const leafNodes = addressList.map((x) => {
    return ethers.utils.solidityKeccak256(
      ['address', 'uint256'],
      [x[0].toLowerCase(), x[1]]
    )
  })
  const tree = new MerkleTree(leafNodes, keccak256, { sortPairs: true })
  const nodeIndex: number = addressList
    .map((x) => x[0].toLowerCase())
    .indexOf(address)
  const rootHash = tree.getRoot()
  console.log('rootHash:', tree.getHexRoot())
  console.log('address:', address, 'nodeindex:', nodeIndex)

  if (nodeIndex === -1) {
    return { statusCode: 400, body: "Your Address don't eligible whitelist" }
  }
  const findedAddress: [string, number] =
    addressList.find((x) => x[0].toLowerCase() === address) ??
    throwError('address can not find')
  const hashedAddress = ethers.utils.solidityKeccak256(
    ['address', 'uint256'],
    [address, findedAddress[1]]
  )
  const hexProof = tree.getHexProof(hashedAddress)
  const verify = tree.verify(hexProof, hashedAddress, rootHash)

  if (!verify) {
    return {
      statusCode: 400,
      body: JSON.stringify({
        address,
        message: 'your address can not verify',
      }),
    }
  }

  return {
    statusCode: 200,
    body: JSON.stringify({
      hexProof,
      address: findedAddress[0],
      presaleMax: findedAddress[1],
    }),
  }
}
const addressList: [string, number][] = [
  ['0xCDE6CcA4D309E14fe8658be19bE9FEe6AAAb6ace', 1],
  ['0xec294eBa47f2a90Da8C05b4c3b3D3B57CACD37C6', 1],
  ['0x083f14959d637cf789497B6aFE476a1E3057F8AF', 1],
  ['0x3d3B69457Ce7e7998f19e85E018B5a296Aed781e', 1],
  ['0x79c5Ab5A774d1133cB5c8fe949F49521829e02d9', 1],
  ['0x8ec40Ee77654849Af84F137f656937F55d81D2C4', 1],
  ['0x923fC9eE70CCba05b6CbB2737961E1D775784576', 1],
  ['0x79fcD310CF8F95fBF5c5d1bA268173A72ad36EF4', 1],
  ['0x45915331b29B55e73Fa48862d89E0dd9BE320942', 1],
  ['0x2C3eD0211d5EA74Ce3dA545b7AF217e4284eA030', 1],
  ['0x6d1f422067c4236687cF6dF7174B97778d04e366', 1],
  ['0xe40370a8154222066C2A75c11B7b1eFe94558703', 1],
  ['0x4B70b870182F65E43E7413Ec33878015EAb7E7Ff', 1],
  ['0x4b980D398B92704e8AC9bad9F51AEE99E3099a93', 1],
  ['0x6B1D1783e307d7D0a1513355e7CD2CE64AAc0e1a', 1],
  ['0x46E119092C3bDD31e7534DBFd97dF2C26710496a', 1],
  ['0x410ebd67158f72783479bd34e463fc406b366c17', 1],
  ['0x51DF1B21F827d42f11eFbb591e51C94a55BD3398', 1],
  ['0x0Bb62ABF3E9ACE55AfCe8B52b61545CD8b960C05', 1],
  ['0x5EA736A591920A72826C7206B0213fFb752882A6', 1],
  ['0x3D9A6d57a44919e27C5A94501aE66E6053291b96', 1],
  ['0x30878aB35F39392081faeCAF61c6d12C4E7cB799', 1],
  ['0x7AA07bDD8955833F45a946a735381131610DDd64', 1],
  ['0x65375f91a2159e472A9f3dF8884DD94C5d697703', 1],
  ['0x82f8E1c3404e1d8534ac637216c2c6a0BcA723ff', 1],
  ['0x7362705517F2CE99f324A226656356cdCE5F2bf3', 1],
  ['0x55c05c91A859493A8B3a1017269Ca706e0FEB344', 1],
  ['0xE2cEc2cC859827b3Dbace7b92e18F83C3e14270d', 1],
  ['0x79B8e17396932a6A94b2bd77a78eFe502FAced5F', 1],
  ['0x5ac9d74D54Ab9F9A67F43DCC980b3Cefc2E1232a', 1],
  ['0xD83211814BB7B865dc55833852Bafd50e566547b', 1],
  ['0xF3400d6Aa004d2F06FF1045eECcef77af98fAA74', 1],
  ['0xAFC10938692f03fe3f949b52bE5b48459389f48c', 1],
  ['0x3a6de8266241991a94c1648e3bec79cc06f0f38f', 1],
  ['0xF696F248eCE1Ae3d8A83eAaCa9027e257551EAba', 1],
  ['0xdBA674AbDc402834fB06780Bb57EE64fb6F815f5', 1],
  ['0xD26826d2219Ae94f9A07F1A4685019Afc9d40FFa', 1],
  ['0x6d3Db011d2361B3D29179c5C33Ac693Fec9042C4', 1],
  ['0x18fc46bFE8B633948A2775797c09386ad5b6c428', 1],
  ['0xC1269906cBCc1708dDaC73D8926502297eB814c6', 1],
  ['0x4Dc72eE9E9722991Cc435c399172278496749D14', 1],
  ['0xfbf9137Aa3aD1F8b38B42D90AFB7e4cB2b39e633', 1],
  ['0x911D3A600009BfE676Dae6E0DcAfb76b37c027aA', 1],
  ['0x02a16B133D170a4144F687E663544B598E4cB07F', 1],
  ['0xbF923438A135a99712D4c4b3DB413a0817a90f99', 1],
  ['0xc3b54264B43cF70bfC6149339e288C8b5c673459', 1],
  ['0xD86e5f96fd5b7EaCca2Be0e21005B05bE3EA36Fb', 1],
  ['0x9561FB2c95929461c0af2227ca3e13CC38885a78', 1],
  ['0x501e16438fE42Be3A3cd3A953556c379804A68E1', 1],
  ['0xef0cB457a0e980ae63Fe16cc4DbD19f40Db372B3', 1],
  ['0x394B9f09c4e0Cf8138016bC4cea8D87011B2bE5d', 1],
  ['0x229286806354dF9f97304623315c81408cD5d597', 1],
  ['0x08Bbaee435C7a1842F177eeAf032F4EF7B51D4A8', 1],
  ['0xe25fe4213821705c3b7b5251089E57cc889f0af4', 1],
  ['0xbA36e597D9d5c8407530637D9895Eb2fFe807067', 1],
  ['0x258f99a5f5e270ac439b62a806d3ad131f04dc14', 1],
  ['0xC86d3f7AE7B28F27596Fefb8dd26eE7eEa372223', 1],
  ['0xC034a920eA1dd1031274455Cc83017C5Ba7a4299', 1],
  ['0x5c051c0FF69b6f5FDD47E847EB370DD48726Ec4d', 1],
  ['0xB7b834276EAa754CD997C7F626A5927BB8e2423A', 1],
  ['0x35b63a6ccA6563fd3495d51F45aebeCF0E1616cF', 1],
  ['0x8B8E45061eB3e31eC3Dc84652b98848671C2a4f7', 1],
  ['0xc00BdaFae2DdFCA38C87b77c567d5F1891AA35fC', 1],
  ['0x6E3BC51810AA3407463bbf2b094BB91EEb91D918', 1],
  ['0xA5ACf68B1fF6e33381797914A906d3797e47ce6c', 1],
  ['0x92b354137AFC70Be4B430d54C5e65A9F13fD7d60', 1],
  ['0xe399a654Bbc275B0850A2e533e3b0569E26666A7', 1],
  ['0x81cF4F8da2d0CA8aC8588F77F55f2a3cBd2336ef', 1],
  ['0x843Bd3a87a274B1eCe7C5b00A48Cd7BFB8356231', 1],
  ['0x12CfBf939acb79DfCA08ec8cd8a5790a8b93a8Ba', 1],
  ['0x0A0378DED4dbceE717dE3e10d9064B0F8982C817', 1],
  ['0x04c678E6C99e55468Cb36f0EFFed2D7437cD7A5d', 1],
  ['0xA8Be5A9cC773618499089C9843b0686e7e32b01A', 1],
  ['0x6fd46104E63cb4730852e99183C758D91204942C', 1],
  ['0xc30520029FaE14783C5712D3eccea2524DA3cB51', 1],
  ['0x20114d7bb14A26dE300E1356013Ce7BDA423ac8f', 1],
  ['0xD5F6812971692117f581796147D2D3a2A579737C', 1],
  ['0x992a414A411b4C50a43c37052F23fCfA06225Ae7', 1],
  ['0x5298D834cf6B3984d4a1f56184FbB87Dac3BE8Ff', 1],
  ['0x0c9862de1e1025e04799cd4095fe732e343c8136', 1],
  ['0x66f93aaEaF011Ddf060cB6cD948ca34325cF16f9', 1],
  ['0xA27C3b28AA4DF44E5CFfC3F1A7267cf6Bf0485Ca', 1],
  ['0xf1aFd190f76E415B4716c899ECfFC4B80020B788', 1],
  ['0x6f8DDA32A800991228Add804e06DC19CffD9bAD9', 1],
  ['0x991eEea3BC88F5af8574296bCbF85764054e9773', 1],
  ['0x587CBdE67dE3DE091361BF5beA1A87F0883A96C2', 1],
  ['0x1e85b6489f306985871205a52edc51a0a7d2a8f5', 1],
  ['0xB025A321adBAd221753dbfE4c0Cb628561192baD', 1],
  ['0xaAA056168b01502F72a2add448daA728B5F090f1', 1],
  ['0xA79F65a6bee0134766A8E7670845930128952C6B', 1],
  ['0x8D0Fd2c4081Ca53DB31346229fCdb1E5DC800c6A', 1],
  ['0xa4b8aB32A80bbFf6310dC873061294328FD86754', 1],
  ['0x975C2B3dd962F2E1D291343D1451ebC9f05298fF', 1],
  ['0x195bD8acaD454922B2CC78573286Fb54Be087161', 1],
  ['0x30474ee838836D9Fb286b73D3381e3D3E6459c10', 1],
  ['0x9Ec6c6144DF8e14D058FC9278E335B7dB4b002D4', 1],
  ['0x6974e95380B66bfa2728c2109332c4EE30AF1b79', 1],
  ['0xBC434B6F4C9377BF6AAf496078221c5188648181', 1],
  ['0xB879FcD114217A0a0e0b7d866200cBbB250F17A7', 1],
  ['0x53412D3c199037eb18dcB046Fa4Df1b3b024C619', 1],
  ['0x43Ff92bD5389C0d4cc69281B13605cF85ca6C5B2', 1],
  ['0xaF44B3bff67902f14480DE9224faEe341a121D81', 1],
  ['0x7f7a949fcCbd2C43bF8a63cd3daD70eA2361EEBD', 1],
  ['0x8b2Fb42a85AE7666A0624C999995Db3060DDC098', 1],
  ['0xC4d7A04c2539638C0a08930839A4fC09A5cAdceF', 1],
  ['0x801f87ab48891aa9b13f2D1EB519842Bdf46f9b1', 1],
  ['0x67e086e9Ac0Ee442fdC8c800C7Bac278bB3809fc', 1],
  ['0x2b852fE7D84D62828D6455826e7e23f28885a125', 1],
  ['0x8933e3466C3caa73CD96Cb367ee03077E6D2a3C4', 1],
  ['0x25CEAc94604b3EB3a751aD751eB97a1e3BBf702a', 1],
  ['0x06BAc69D925002B5B1e5553b8C20f997144905c0', 1],
  ['0x41FfB8979D26d299Ed0F1a37EE99D7191194ce1c', 1],
  ['0xb4463C685D2EAB5794bC70ffe58090E77b3C1947', 1],
  ['0x4876aBFa6a5997DF937A3C3bEAcfCa75f33C9BE2', 1],
  ['0x90dB29D6c9D5900253F1aD4575064259871302De', 1],
  ['0x79611EEd03B52b7A1B89b28a6ff7c40aF3e58B0c', 1],
  ['0x0b858752Eb66C0386F86a12b6dB42ca4Dc666924', 1],
  ['0x6e4d867B0b9DA23D0b15e28D1DdC8f382e9e3a5b', 1],
  ['0xAAD26C26D95F7537997DbB7A6767326D9F9f4995', 1],
  ['0x3871b5C502cf4783a0e4660A39AFbcb71e8169F8', 1],
  ['0x3994983050F1998f53e5009b723C78D9929F7d11', 1],
  ['0x5Df7143C7512c32Bc45FF4428bc75d3082D82056', 1],
  ['0x14c582A7DAC91D302f5F8e881F76E30e06991535', 1],
  ['0x038c6675EF1597CAB122204EF5994594c953ee0D', 1],
  ['0xC3D3e3DA141EcCe9Cb2098A7D44355B9f0b26eA7', 1],
  ['0x17336E32c92278e26f7F36D7686Ef50d46AB5F56', 1],
  ['0xE1bF8C01891C4D5f52E0a97d8880D24299e7302E', 1],
  ['0x961d2C942aECE305A9911652E1fb303A1e5D4902', 1],
  ['0xE3197391348C02044fbcD853FB6F800f09C4D037', 1],
  ['0xF1D8abaF1F2234ef500F252F8AE90af5329A6724', 1],
  ['0x4A33cEBC2d819a422e7217c5cAe804792f41F9e8', 1],
  ['0xD5e271c9fe0999cD735E5AD4F37eBC26f34EB6e2', 1],
  ['0x7f75846016aCF8F75139cdd0AD1618eBB1355934', 1],
  ['0xa517Bcc4d563DB739446dBC7703690ADaDe2e13d', 1],
  ['0x74b445e44cb757d8aa0c71e28ee940fef5af8900', 1],
  ['0xD51f9d76fdc348be528219F70D80784ddf53Ab8d', 1],
  ['0x06879f5343345979cD369b42104282BEf0Efd540', 1],
  ['0x1D3E52C1217458697291A6839C8aA3669F60239E', 1],
  ['0x030CA904672ef4858cC9916c6AcFa9366B492CDA', 1],
  ['0x54F022924D6d8dE34EF447CaFbc875b703b233Dc', 1],
  ['0xe302603a2e9B1a2306537FDafcd967be98aF9f5D', 1],
  ['0xE2bfB826Ef8040729518d86ED399c0C32985D2D7', 1],
  ['0x948feCEd16F4aEf930f6Def5343B58C44ef960c5', 1],
  ['0x709eB29F076699F75DB1dE286a46520334D63ef5', 1],
  ['0x6dc3120ed771D18682d7e90D30311FA2A1069Bb8', 1],
  ['0x56279303949C6A5B67ebec628178869a35492832', 1],
  ['0xBc8B9Ae8ae38490c77E1AC5a63B525f546C7F2dF', 1],
  ['0xbea72d78bfe1d9c7f10adbfd13f0476101cd00df', 1],
  ['0xea15F70EF61352334EB1c77d39f304F51dB8A3cE', 1],
  ['0x3C6D73bB84A85D306BF7db9A8861c980dF5EA1F4', 1],
  ['0x2AAd5f9f9B11b245B71d6F8EC88A4D257Ec1B061', 1],
  ['0x95a598AaD64F8b57d16010211C75c476c4e535dF', 1],
  ['0x445c7460Aa27BF507dD23848Af3f34208e1a365C', 1],
  ['0x60B249157EA5b41a3F6000A9a5782d33318744Dd', 1],
  ['0x5b21FB2C519F5E42789bE874B5ebc9734d0Fa32B', 1],
  ['0x33B10A040277d808DE1dB417ADa90c9de79AD0d2', 1],
  ['0xECEDDbD9c92E8ecC5f00BD4FF93C692BEc1fA221', 1],
  ['0xCe58E9C28cc9716B090fF181BacDE9761Fe82254', 1],
  ['0xBF714b32206EdCEd749B22E9d01a01C676BA7f40', 1],
  ['0xb875726E90A437b722726BCCA9C173Cb6Ee58278', 1],
  ['0x5DDCbe1Ec48eBACED1D8739dDf87de38E7fB52BB', 1],
  ['0xc08490D7B857bDb7703434676659a0484aEC5b26', 1],
  ['0x929A385BCD8172C554762bD2D46bb4e2eDABa6fd', 1],
  ['0x35f977EC82e372E8b3Dc260cEA38053385125187', 1],
  ['0x36209606619a8570e53dce3d04f3e8a2ab23e093', 1],
  ['0xf04c8ded40ef9481f6dF1141526AD88f4622247c', 1],
  ['0x3CA127317357eF3acB4C165e70b1Bc0aC71A020d', 1],
  ['0xa5b2eE569fF5Fea84261533b5804E69af4227979', 1],
  ['0x092fcF216095a4cB7aC616BD30b26C4141b39019', 1],
  ['0xeAB0f95caB06100C826e7dd548DFd5cbdD3a0EE9', 1],
  ['0x463EEd4c7D66de5B1e1aE228A1A14e0eE7c65c0A', 1],
  ['0xA2BA6C51bB4A62717B96A9E1A74Ac29109E99623', 1],
  ['0xfA99c5E78e5f8d0d367B15a0B5469CC15B0FBdaE', 1],
  ['0x313eBb55cAA1D43Dc8EA2De81146d93d8Eaa7823', 1],
  ['0x430c86042eb9E6E4c32E1eC80b76d7c007e7aeAD', 1],
  ['0x5D67096571F54542C5950d22122A030C308E7eCB', 1],
  ['0xbDe8Eb28E421F68ec68388cAc39f64a952256dad', 1],
  ['0x873189010EA10be77bf2A4A18ff6F1b26d94D340', 1],
  ['0x9076d31F81512E040Cc07CfE2031cf251236A741', 1],
  ['0x61c39def87077FfabAD37426eDa42495d1E6F420', 1],
  ['0xE365E26057AEB4016D7600cCf9199b2c33B2F4ac', 1],
  ['0x1405C60aE36c35890c55640B268cAC9452C56457', 1],
  ['0x77fF0BbCCA6865Ea5A29cB2c5574a700a9109982', 1],
  ['0x1922946d66101Cc38E12807c235E8d8d079B02eB', 1],
  ['0xC39968B3a82fB242bB25Fa377dee5FC88c3d105b', 1],
  ['0xd62D284e404ADe4F76DD7095a135639Fe953D331', 1],
  ['0xf458c77e4b9DF3F721826379ed096512F830824f', 1],
  ['0x3Ac8baf4bba28da4b478825Ba765ad2c7AA745FF', 1],
  ['0xa9f053e27Bd149A27a83057534238319344797F9', 2],
  ['0xF0669Ef23b776Bb5998920647996BB3A137CA52A', 2],
  ['0xa425BF0677fB80d6Fe98536069daf8C8D1E455c1', 2],
  ['0x348e7817E3c5a6Ae9af2D8A1fB35c9a05F56CbE8', 2],
  ['0xA63Bac41CcF8eCC3C905C4b9D262e2741C999EbD', 2],
  ['0x66143651495a1cCbFd2F708af8336C580935349a', 2],
  ['0xdFc66F4FD026cd0673cf65c6019c6a9c92413129', 2],
  ['0xF4a2d18354E98ef2CDe414eE37Bb6cCF7A583683', 2],
  ['0x94E8629d24fE93bD8Be6F9738B1aDA71e2dF4Be5', 2],
  ['0x19b97B896C241Fc39852b1BC0EdE5364a5B011f7', 2],
  ['0x336558EbD351aA5b3f273FD8AE4Fa66Ba3D2D49e', 2],
  ['0x8b495AEbBfA94D8Bf7F3a60AfcF66f5BFB5BBC61', 2],
  ['0x27a2AdC97246eC7580388bF20d19f889d56388e9', 2],
  ['0x85abbca67978a9b49d5224a9d3b9950ab5ecb520', 2],
  ['0x2273A69a305237cdEE9A6f419F920A32A02A5c8d', 2],
  ['0xAb73C858A0C164023C560F73fc8Ab3e95534760E', 2],
  ['0x4455010a893FB1bF634F180E20A63238a9c47307', 2],
  ['0x539B750DF1F193F297a73da850e53cB63A4E5EDe', 2],
  ['0x75EF10fE777D4D04DB255D3cBa5AdF5cEbd2F1E3', 2],
  ['0x646629f7363B26DAc072238a77EE5e462e2B0097', 2],
  ['0xBEeA50D91a3E0Bf7ed39A4178aF78bbaEe578a59', 2],
  ['0xfe04341659cD6b0885a5B77fccB4Fc61C227fA12', 2],
  ['0x2597e887C06Fa7AC2b674069046ea980579865d3', 2],
  ['0x66e3ac7D8562bC3d6D1eb42436CA520e0E5FF4C6', 2],
  ['0x180e55c857ff5d2847e35498636c8000a5620a38', 2],
  ['0x878eD00d511D1C1333A68ed3eFB9318D229d37Cf', 2],
  ['0x2867EE9e294954eC31517e2d1e8dF9E82D742A33', 2],
  ['0x3383820dFC906cC59B989FF7E87e68F0AcA78c77', 2],
  ['0x5D1F056deb05c7cC523635b6C19dc977E1542317', 2],
  ['0xbD75d56C9c3B146B9B1f23Afb898680d48641850', 2],
  ['0x74433eDe05E90B31d2c36cfD0be51921B438E500', 2],
  ['0x26ac3aD949a2c9A4E3Dde9De4e7c363c7aCcd7f7', 2],
  ['0x6E3CE12fADA11CE7bD89bB0fEEa9301cac628051', 2],
  ['0x2BEaeabaD4D04dC2c0C06F02b3089A9617Bfe6b7', 2],
  ['0x43Ff92bD5389C0d4cc69281B13605cF85ca6C5B2', 2],
  ['0x85AE105b4e24DFFeb4e93e86C973A52050601b56', 2],
  ['0xD5e271c9fe0999cD735E5AD4F37eBC26f34EB6e2', 2],
  ['0xEF2e94F2cB2318acd98C7b9f7AFEf704E350ca0b', 2],
  ['0x313eBb55cAA1D43Dc8EA2De81146d93d8Eaa7823', 2],
  ['0x33F3ea5584dab8eb86D049883c639828B260649A', 2],
  ['0xB7E0856E56AbD35f7259eA961F360d5551023AE5', 2],
  ['0x89D4e3436e331b531f85B08Fd7b1B9e027D92beD', 2],
  ['0xb71fd6A80eE56DB36C79585E7cA8a354bF8c3B9C', 2],
  ['0x1e58Dd05e10f68Cf53D414a248047614fD2D375f', 2],
]

function throwError(errorString: string): any {
  throw new Error(errorString)
}
